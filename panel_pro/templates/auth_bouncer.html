<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion Discord</title>
    <style>
        body { background-color: #2f3136; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; text-align: center; }
        .loader { border: 4px solid #202225; border-top: 4px solid #5865F2; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .btn { background-color: #5865F2; color: white; text-decoration: none; padding: 12px 24px; border-radius: 5px; font-weight: bold; margin-top: 20px; display: inline-block; border: none; cursor: pointer;}
        .sub-text { opacity: 0.7; font-size: 0.9rem; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="loader"></div>
    <h3>Ouverture de Discord...</h3>
    
    <a href="{{ auth_url }}" class="btn">Continuer via le Navigateur</a>
    <p class="sub-text">Si l'application ne s'ouvre pas automatiquement.</p>

    <script>
        var webUrl = "{{ auth_url | safe }}";
        var appUrl = webUrl.replace("https://", "discord://");
        var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

        if (isMobile) {
            // Astuce : iframe cachée pour éviter l'erreur ERR_UNKNOWN_URL_SCHEME sur Android
            // Si ça échoue, ça ne change pas la page actuelle, donc pas d'erreur visible
            var iframe = document.createElement("iframe");
            iframe.style.border = "none";
            iframe.style.width = "1px";
            iframe.style.height = "1px";
            iframe.src = appUrl;
            document.body.appendChild(iframe);
            
            // Fallback : si on est toujours là après 2.5 secondes, on redirige vers le Web
            setTimeout(function() {
                // On vérifie si l'utilisateur est toujours actif sur la page
                if (!document.hidden) {
                    window.location.href = webUrl;
                }
            }, 2500);
        } else {
            window.location.href = webUrl;
        }
    </script>
</body>
</html>